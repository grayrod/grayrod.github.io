<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>grayrod / Controlled Chaos</title>
    <meta name="description" content="Watch and control chaotic orbits generated by iterative mappings" />
    <link href="https://fonts.googleapis.com/css?family=VT323" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="maps.js"></script>
    <script type="text/javascript" src="grapher.js"></script>
    <script type="text/javascript" src="graph.js"></script>
    <script type="text/javascript" src="params.js"></script>
</head>

<body>
  <div id="top">

      <div id="topleft">
        <div id="menu" class="topbtn" style="display:none">
          <p> _ <br /> _ <br /> _ <br /></p>
        </div>
        <div id="name">
        <p>Controlled Chaos</p>
        </div>
      </div>

      <div id="topmiddle">
        <div id="params4" class="params">
          <p></p>
        </div>
        <div id="params3" class="params">
          <p></p>
        </div>
        <div id="params2" class="params">
          <p></p>
        </div>
        <div id="params1" class="params">
          <p></p>
        </div>
      </div>

      <div id="topright">
        <div id="playpause" class="topbtn" style="letter-spacing:-2px" onclick="playPause()">
          <p>|| </p>
        </div>
        <div id="speedup" class="topbtn" style="display:none; letter-spacing:-6px" onclick="speedUp()">
          <p>>></p>
        </div>
        <div id="slowdown" class="topbtn" style="display:none; letter-spacing:-6px" onclick="slowDown()">
          <p><<&nbsp;</p>
        </div>
        <div id="loop" class="topbtn" style="display:none" onclick="loopUnloop()">
          <p>O</p>
        </div>
        <div id="zoomin" class="topbtn" style="display:none" onclick="zoomIn()">
          <p>+</p>
        </div>
        <div id="zoomout" class="topbtn" style="display:none" onclick="zoomOut()">
          <p>-</p>
        </div>
        <div id="instructions" width="300px" height="47px" style="display:none">
          <p>Click a graph!</p>
        </div>
        <!-- <div id="colors" class="topbtn">
          <p>c</p>
        </div> -->
        <!-- <div id="mode" class="topbtn" onclick="changeParams(0, genSet1);changeParams(1, genSet2)">
          <p>*</p>
        </div> -->
        <!-- <div id="about" class="topbtn">
          <p>?</p>
        </div> -->
      </div>

  </div>

  <div id="main">
    <div class="container">
      <div class="graph" id="graph1"></div>
    </div>
    <div class="container">
      <div class="graph" id="graph2"></div>
    </div>
    <div class="container">
      <div class="graph" id="graph3"></div>
    </div>
    <div class="container">
      <div class="graph" id="graph4"></div>
    </div>
 </div>

 <div id="bottom">
   <a href="https://github.com/grayrod/grayrod.github.io/tree/master/chaos" target="_blank">GitHub</a>
</div>

 </body>

<script>
$(document).ready(function() {
  graphArray = [];
  genArray = ["shuffle", "shuffle", "shuffle", "shuffle"];

  var countdown1 = setTimeout(function() {
    graph1 = new Graph("graph1", "params1", genArray[0], colors.darkgray, draw2x2, colors.lime );
    graphArray.push(graph1);
    graph1.initialize();
    graph1.start();
  },100);

  var countdown2 = setTimeout(function() {
    graph2 = new Graph("graph2", "params2", genArray[1], colors.darkgray, draw2x2, colors.magenta );
    graphArray.push(graph2);
    graph2.initialize();
    graph2.start();
  },1300);

  var countdown3 = setTimeout(function() {
    graph3 = new Graph("graph3", "params3", genArray[2], colors.darkgray, draw2x2, colors.yellow );
    graphArray.push(graph3);
    graph3.initialize();
    graph3.start();
  },2500);

  var countdown4 = setTimeout(function() {
    graph4 = new Graph("graph4", "params4", genArray[3], colors.darkgray, draw2x2, colors.cyan );
    graphArray.push(graph4);
    graph4.initialize();
    graph4.start();
    $('#instructions').show()
  },3700);

});

var focus = null;
var ll = $( '#loop > p' );
var pp = $( '#playpause > p' );

$('div.container').mousedown(function(){

  if (focus == null) {

    focus = $(this).index();
    focused = graphArray[focus];
    pauseAllExceptMe();
    $('div.container').each(function(){
      if ($(this).index() != focus) {
        $(this).hide();
      }
    });
    $(this).css("width", "100%");
    $(this).css("height", "100%");
    $('#zoomout').show();
    $('#zoomin').show();
    $('#speedup').show();
    $('#slowdown').show();
    $('#loop').show();
    $('#instructions').hide()
    if (focused.s.looped == true) {
      ll.html('!o');
    } else {
      ll.html('o');
    }
    if (focused.s.paused == true) {
      pp.html('>');
    } else {
      pp.html('||');
    }
    focused.n = 10000;
    focused.draw();

  } else {
    if (focused.s.paused == false) {
      focused.stop();
    }
    focused.n = 3000;
    $(this).css("width", "50%");
    $(this).css("height", "50%");
    $('div.container').each(function(){
      var index = $(this).index();
      if (index != focus) {
        $(this).show();
        graphArray[index].draw();
      }
    });
    focused.draw();
    $('#zoomout').hide();
    $('#zoomin').hide();
    $('#speedup').hide();
    $('#slowdown').hide();
    $('#loop').hide();
    pp.html('||');
    playAllExceptPaused();
    focus = null;

  }

});

$(window).resize(resizeGraphs());

 if ( window.orientation != undefined )
   window.onorientationchange = resizeGraphs();

function resizeGraphs() {
  if (typeof graphArray !== 'undefined') {
    pauseAllExceptPaused();
    clearTimeout(waiter);
    waiter = setTimeout(function() {
      playAllExceptPaused();
    }, 100);
  }
}

function playPause() {
  if (focus != null) {
      if (focused.s.paused == false) {
        pauseMe();
      } else {
        playMe();
      }
  } else {
      if (pp.html() == "||") {
        pauseAll();
      } else {
        playAll();
      }
  }
  // logPausedStates();
}

function pauseAll() {
  for (var i=0; i<4; i++) {
    if (graphArray[i].s.paused == false) {
      graphArray[i].stop();
      graphArray[i].s.paused = true;
    }
  }
  pp.html('>');
}

function playAll() {
  for (var i=0; i<4; i++) {
    graphArray[i].resume();
    graphArray[i].s.paused = false;
  }
  pp.html('||');
}

function pauseMe() {
  focused.stop();
  focused.s.paused = true;
  pp.html('>');
}

function playMe() {
  focused.resume();
  focused.s.paused = false;
  pp.html('||');
}

function pauseAllExceptMe() {
  var len = $('div.container').length;
  for (var i=0; i<len; i++) {
    if (i != focus) {
      graphArray[i].stop();
    }
  }
}

function pauseAllExceptPaused() {
  for (var i=0; i<4; i++) {
    if (graphArray[i].s.paused == false) {
      graphArray[i].stop();
    }
  }
}

function playAllExceptPaused() {
  for (var i=0; i<4; i++) {
    if (graphArray[i].s.paused == false) {
      graphArray[i].resume();
    }
  }
  pp.html('||');
}

function loopUnloop() {
  if (focused.s.looped == false) {
    loopMe();
  } else {
    unLoopMe();
  }
}

function loopMe() {
  focused.s.looped = true;
  ll.html('&#216;');
  // logLoopedStates();
}

function unLoopMe() {
  focused.s.looped = false;
  ll.html('o');
  // logLoopedStates();
}

function changeParams(i,paramsObject) {
  graphArray[i].o = paramsObject;
  graphArray[i].stop();
  graphArray[i].initialize();
  graphArray[i].start();
}

function zoomOut() {
  if (focused.zi > 0) {
    focused.zi = focused.zi - 1;
    focused.scale = focused.zf[focused.zi];
    if (focused.s.paused == true) {
      focused.draw();
    }
  }
}

function zoomIn() {
  if (focused.zi < 23) {
    focused.zi = focused.zi + 1;
    focused.scale = focused.zf[focused.zi];
    if (focused.s.paused == true) {
      focused.draw();
    }
  }
  console.log(focused.zi);
}

function slowDown() {
  if (focused.br > 0.000001) {
    focused.br = (focused.br)/10;
  }
  if (focused.s.accelerated != true) {
    focused.s.accelerated = true;
  }
  // logAcceleratedStates();
}

function speedUp() {
  if (focused.br < 0.1) {
    focused.br = (focused.br)*10;
  }
  if (focused.s.accelerated != true) {
    focused.s.accelerated = true;
  }
  // logAcceleratedStates();
}

// function logPausedStates() {
//   console.log("paused state");
//   for (var i=0; i<4; i++) {
//     console.log(i + ": " + graphArray[i].s.paused);
//   }
// }
// function logLoopedStates() {
//   console.log("looped state");
//   for (var i=0; i<4; i++) {
//     console.log(i + ": " + graphArray[i].s.looped);
//   }
// }
// function logAcceleratedStates() {
//   console.log("accelerated state");
//   for (var i=0; i<4; i++) {
//     console.log(i + ": " + graphArray[i].s.accelerated);
//   }
// }

 </script>

</html>
